# Filename: nginx.conf

worker_processes  1;
events {
    worker_connections 1024;
}

http {
    # 1) Define an upstream block with all backend IPs
    upstream django_backends {
        # Replace these with your real private IPs + port
        server 10.0.5.10:8000;
        server 10.0.5.11:8000;
        # You can add more servers if needed:
        # server 10.0.5.12:8000;
        # server 10.0.5.13:8000;
    }

    # 2) Declare the server (the “LB”)
    server {
        listen       80;            # listens on port 80 inside the container/VM
        server_name  _;             # catch‐all

        # Pass all requests to the “django_backends” upstream
        location / {
            proxy_pass         http://django_backends;
            proxy_set_header   Host $host;
            proxy_set_header   X-Real-IP $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Proto $scheme;

            # (Optional) If you have CSRF or session cookies that depend on 
            # Host/header, you can adjust those here.
        }

        # (Optional) If you serve static files from Django, you could
        # add something like:
        # location /static/ {
        #   alias /path/to/collected/static/;
        # }
    }
}
